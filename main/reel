#!/usr/bin/env php
<?php

require __DIR__ . '/vendor/autoload.php';

use App\Domain\Reel;
use App\Framework\Console\JobConsoleCommand;
use Symfony\Component\Console\Application;

$reel = createReel();

$app = new Application("reel", file_get_contents('/VERSION'));
$app->add(new \App\Framework\Console\PropertiesConsoleCommand($reel));

foreach ($reel->getJobs() as $job) {
    $app->add(new JobConsoleCommand($job));
}

$app->run();

/**
 * @return Reel
 */
function createReel(): Reel {
    $config = new \App\Domain\Config();
    $config->addDirectory(new \App\Domain\ConfigDirectory(__DIR__ . "/.reel", ""));
    $config->addDirectory(new \App\Domain\ConfigDirectory(getcwd() . "/.reel", "app"));

    $finderFactory = new \App\Domain\Glue\FinderFactory();
    $yamlParserFactory = new \App\Domain\Glue\YamlParserFactory();
    $jobFactory = new \App\Domain\JobFactory();

    return (new \App\Domain\ReelFactory($finderFactory, $yamlParserFactory, $jobFactory))->create($config);
}